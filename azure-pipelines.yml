trigger:
  branches:
    include:
    - daveta-python-functional
    exclude:
    - master

variables:
  # Container registry service connection established during pipeline creation
  imageName: 'functionaltestpy'
  dockerRegistryServiceConnection: 'NightlyE2E-Acr'
  dockerFilePath: 'libraries/functional-tests/functionaltestbot/Dockerfile'
  tag: 'python'

jobs:
# Build and publish container
# - job: buildPush
#   pool:
#     vmImage: 'Ubuntu-16.04'
#   displayName: Build and push bot image
#   continueOnError: false

#   steps:
#   - task: Docker@2
#     displayName: Build and push bot image
#     inputs:
#       command: buildAndPush
#       repository: $(imageName)
#       dockerfile: $(dockerFilePath)
#       containerRegistry: $(dockerRegistryServiceConnection)
#       tags: $(tag)

- job: provisionContainer
  displayName: Provision bot container
  # dependsOn:
  # - buildPush
  container:
    image: nightlye2etest.azurecr.io/functionaltestpy:latest
    endpoint: NightlyE2E-Acr
  steps:
  - script: flask run --port 3978 --host 0.0.0.0
